version: 2
jobs:
  ci:
    working_directory: ~/app
    docker:
      - image: circleci/node:7.10

    steps:
      - checkout

      - run:
          name: Install Dependencies
          command: npm install

#      - run:
#          name: Unit Tests
#          command: npm test

  deploy-staging:

      - add-ssh-keys:
          fingerprints:
            - "81:c8:44:89:af:ef:08:f3:4b:a7:85:77:ae:38:bd:50"

      - run:
          name: Deploy Master to Heroku
          command: |
            if [ "${CIRCLE_BRANCH}" == "master" ]; then
              # Heroku's fingerprint
              echo 'heroku.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAu8erSx6jh+8ztsfHwkNeFr/SZaSOcvoa8AyMpaerGIPZDB2TKNgNkMSYTLYGDK2ivsqXopo2W7dpQRBIVF80q9mNXy5tbt1WE04gbOBB26Wn2hF4bk3Tu+BNMFbvMjPbkVlC2hcFuQJdH4T2i/dtauyTpJbD/6ExHR9XYVhdhdMs0JsjP/Q5FNoWh2ff9YbZVpDQSTPvusUp4liLjPfa/i0t+2LpNCeWy8Y+V9gUlDWiyYwrfMVI0UwNCZZKHs1Unpc11/4HLitQRtvuk0Ot5qwwBxbmtvCDKZvj1aFBid71/mYdGRPYZMIxq1zgP1acePC1zfTG/lvuQ7d0Pe0kaw==' >> ~/.ssh/known_hosts

              # Push changes
              git push --force git@heroku.com:$HEROKU_APP_NAME_STAGING.git HEAD:refs/heads/master
            fi

workflows:
  version: 2
  ci:
    jobs:
      - ci:
          filters: 
            branches:
              only: master
      - deploy-staging:
          requires: 
            - ci
